<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: sans-serif; background: #1a1d21; color: white; margin: 0; padding: 15px; }
        .page { display: none; }
        .active { display: block; }
        .card { background: #2b2f36; padding: 15px; border-radius: 12px; margin-bottom: 10px; border: 1px solid #3d434d; }
        .flex { display: flex; justify-content: space-between; align-items: center; }
        .price { color: #4CAF50; font-weight: bold; }
        button { border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .buy { background: #2481cc; color: white; padding: 10px 15px; }
        .refresh-btn { background: #3d434d; color: #aaa; padding: 8px 12px; width: 100%; margin-top: 10px; font-size: 13px; }
        .tab-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: #2b2f36; display: flex; justify-content: space-around; padding: 15px 0; border-top: 1px solid #444; }
        .tab { background: none; color: #888; font-size: 12px; }
        .tab.active { color: #2481cc; }
    </style>
</head>
<body>

    <div id="shop" class="page active">
        <h2>üõí –ú–∞–≥–∞–∑–∏–Ω</h2>
        <div class="card flex">
            <div><b>–ê—Ä—Ö–∏–≤</b><br><span class="price">250‚ÇΩ</span></div>
            <button class="buy" onclick="sendOrder('–ê—Ä—Ö–∏–≤', 250)">–ó–∞–∫–∞–∑–∞—Ç—å</button>
        </div>
    </div>

    <div id="profile" class="page">
        <h2>üë§ –ü—Ä–æ—Ñ–∏–ª—å</h2>
        <div class="card">
            <div class="flex"><span>ID:</span> <span id="u_id">0</span></div>
            <div class="flex" style="margin-top:10px;"><span>–ë–∞–ª–∞–Ω—Å:</span> <span id="u_bal" style="color:#4CAF50">0‚ÇΩ</span></div>
            <button class="refresh-btn" onclick="refreshBalance()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å –±–∞–ª–∞–Ω—Å</button>
        </div>
        <p style="font-size: 11px; color: #666; text-align: center;">–ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–∫—Ä–æ–µ—Ç—Å—è, –∏ –±–æ—Ç –ø—Ä–∏—à–ª–µ—Ç –Ω–æ–≤—É—é —Å—Å—ã–ª–∫—É.</p>
    </div>

    <div class="tab-bar">
        <button class="tab active" id="btn-shop" onclick="tab('shop')">–ú–ê–ì–ê–ó–ò–ù</button>
        <button class="tab" id="btn-profile" onclick="tab('profile')">–ü–†–û–§–ò–õ–¨</button>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();

        function tab(name) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById(name).classList.add('active');
            document.getElementById('btn-' + name).classList.add('active');
        }

        // –§—É–Ω–∫—Ü–∏—è –∑–∞–∫–∞–∑–∞ (—Å –≤–∏–∑—É–∞–ª—å–Ω—ã–º —Å–ø–∏—Å–∞–Ω–∏–µ–º)
        function sendOrder(name, price) {
            let balElem = document.getElementById('u_bal');
            let currentBal = parseInt(balElem.innerText);
            
            if (currentBal < price) {
                alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!");
                return;
            }

            let comment = prompt("–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É:");
            if (comment) {
                balElem.innerText = (currentBal - price) + '‚ÇΩ'; // –°–ø–∏—Å–∞–ª–∏ –≤–∏–∑—É–∞–ª—å–Ω–æ
                tg.sendData(JSON.stringify({service: name, price: price, comment: comment}));
            }
        }

        // –§–£–ù–ö–¶–ò–Ø –û–ë–ù–û–í–õ–ï–ù–ò–Ø
        function refreshBalance() {
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–∏–≥–Ω–∞–ª –±–æ—Ç—É
            tg.sendData(JSON.stringify({action: 'refresh'}));
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, —Ç–∞–∫ –∫–∞–∫ –±–æ—Ç –¥–æ–ª–∂–µ–Ω –ø—Ä–∏—Å–ª–∞—Ç—å –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            tg.close();
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ URL
        const params = new URLSearchParams(window.location.search);
        document.getElementById('u_id').innerText = params.get('id') || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
        document.getElementById('u_bal').innerText = (params.get('balance') || '0') + '‚ÇΩ';
    </script>
</body>
</html>
