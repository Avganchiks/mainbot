const tg = window.Telegram.WebApp;
tg.expand();

// Извлекаем данные
const urlParams = new URLSearchParams(window.location.search);
const userId = tg.initDataUnsafe?.user?.id || urlParams.get('id');

const balanceElement = document.getElementById('balance');
const API_URL = "https://plenteously-unpromising-emilee.ngrok-free.dev";

async function loadBalance() {
    if (!userId) {
        balanceElement.innerText = "Ошибка: ID не найден в TG";
        return;
    }

    try {
        // Добавляем /get_balance/ к ссылке ngrok
        const response = await fetch(`${API_URL}/get_balance/${userId}`);
        
        if (!response.ok) {
            throw new Error(`Ошибка сервера: ${response.status}`);
        }

        const data = await response.json();
        balanceElement.innerText = `${data.balance} руб.`;
        
    } catch (e) {
        balanceElement.innerText = "Ошибка соединения с FastAPI";
        console.error(e);
    }
}

loadBalance();
